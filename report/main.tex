\documentclass{article}
\usepackage{fancyhdr}
\usepackage{lastpage}
\usepackage{listings}
\usepackage[margin=1in]{geometry}
\usepackage{xcolor}
\usepackage{gnuplot-lua-tikz}
\usepackage{subfig}
\usepackage{float}
\usepackage{siunitx}
\usepackage{todonotes}

\lstset{
	language=C,
	basicstyle=\footnotesize\ttfamily,
	commentstyle=\footnotesize\ttfamily \color{black!60},
	numbers=left,
	numberstyle=\tiny,
	stepnumber=1,
	numbersep=5pt,
	frame=lines,
	tabsize=4,
	breaklines=true,
	breakatwhitespace=true,
	showspaces=false,
	captionpos=b
}

\pagestyle{fancy}
\lhead{ECE-C353}
\chead{Final Project}
\rhead{Sean Barag}
\cfoot{\thepage\ of \pageref{LastPage}}

\newcommand{\clst}[2]{
	\begin{center}
	\parbox{.6\textwidth}{
	\lstinputlisting[firstline=#1, lastline=#2, firstnumber=#1]{../src/work_crew.c}}
	\end{center}
}

\newcommand{\hlst}[2]{
	\begin{center}
	\parbox{.6\textwidth}{
	\lstinputlisting[firstline=#1, lastline=#2, firstnumber=#1]{../src/work_crew.h}}
	\end{center}
}

\newcommand{\ttt}[1]{\texttt{#1}}

\title{ECE-C353: Systems Programming \\ Final Project}
\author{Sean Barag \\ \ttt{<sjb89@drexel.edu>}}
\date{\today}

\begin{document}
\maketitle
\section{Design}
The design for this multi-threaded recursive text search was based mostly on
provided code, but included heavy modification to prevent deadlocks.

\subsection{Header File}
All global instance, function, and type definitions were placed in the header
file~\ttt{work\_crew.h}, to improve the readability of the main source
file~\ttt{work\_crew.c}.
%
\hlst{1}{11}
%
These objects were declared globally, with the following intended meanings:
%
\begin{center}
\parbox{.85\textwidth}{
\begin{description}
	\item[NUM\_THREADS]{Maximum number of threads to possibly create.}
	\item[num\_threads]{Number of threads that have been spawned at any time.}
	\item[number\_sleeping]{Number of spawned threads that are currently sleeping.}
	\item[all\_done]{Boolean-like variable indicating if the entire origin directory has been searched.}
	\item[spawned]{Boolean-like variable indicating if other threads have been spawned yet.}
	\item[threads]{Pointer to array of type \ttt{pthread}, containing one element for each thread spawned.}
	\item[wake\_up]{Signal to wake threads up from sleeping.}
	\item[num\_sleeping]{Mutex protecting \ttt{number\_sleeping}.}
	\item[sleepers]{Pointer to array of mutexes protecting \ttt{number\_sleeping}.}
	\item[done]{Mutex protecting \ttt{all\_done}.}
\end{description}
}
\end{center}

In order to provide each thread with the appropriate information, a custom
datatype was created as shown below.
%
\hlst{13}{26}
%
Similar to previous assignments, the following pieces of information were
passed to each thread:
%
\begin{center}
\parbox{.85\textwidth}{
\begin{description}
	\item[threadID]{Integer identifier for the thread.  The first thread
	spawned will receive ID~0, and subsequent threads will receive~1,~2,
	$\ldots$ , \ttt{NUM\_THREADS} - 1.}
	\item[queue]{Pointer to the queue of files and directories to search.}
	\item[mutex\_queue]{Pointer to the mutex protecting the work queue.}
	\item[num\_occurences]{Pointer to the integer representing the number of occurrences of the target string.}
	\item[mutex\_count]{Pointer to the mutex protecting~\ttt{num\_occurences}.}
\end{description}
}
\end{center}
%
Additionally, a custom datatype was created to ease the process of generating
scriptable output.
%
\hlst{28}{35}
%
While these instance variables are fairly self-explanatory, they were created
with the following intended meanings:
%
\begin{center}
\parbox{.85\textwidth}{
\begin{description}
	\item[count]{The number of occurrences of the target string found by the returning function.}
	\item[time]{Amount of time required to execute the returning function.}
\end{description}
}
\end{center}

Finally, the non-main functions were declared:
%
\hlst{38}{40}
%
in which~\ttt{search\_for\_string\_serial} is the single-threaded
implementation,~\ttt{search\_for\_string\_mt} is the multi-threaded
implementation, and~\ttt{worker\_thread} is the function executed by each
thread.


\subsection{Initialization}
\subsection{Thread Creation}
\subsection{Processing}
\section{Results}
\input{img/plot/multiThreadPlot.tex}
\appendix
\section{Bash Testing Script}
%	\begin{center}
%	\parbox{.6\textwidth}{
%	\lstinputlisting{../getData.sh}}
%	\end{center}
\end{document}

